# WARNING - Generated by {fusen} from dev/flat_simulate_mvmt.Rmd: do not edit by hand

test_that("simulate_trajectory works", {
  expect_true(inherits(simulate_trajectory_CPF, "function")) 
  
  library(ggplot2)
  library(viridis)
  library(tidyterra)
  library(lubridate)
  colony.location <- data.frame(Lon = 50, Lat = 50)
  cdt <- generate_env_layer(grid = create_grid(), n = 1, seed = 25)
  daylength <- insol::daylength(long = colony.location$Lon, 
                              lat = colony.location$Lat, 
                              jd = insol::JD(as.POSIXct("2022-08-01", tz = "UTC")), tmz = 0)
sunrise <- format(as.POSIXct(daylength[,1]*3600, 
                             origin = as.POSIXct("2022-08-01", tz = "UTC"), "%H:%M", tz = "UTC"))

  expect_true(
    is.data.frame(simulate_trajectory_FR(initial.position = colony.location, 
                    resource.layer = cdt$rasters, 
                    starting.hour = ymd_hms(sunrise), # departs at sunrise
                    starting.bearing = c(90,10), 
                    starting.step = c(4.5, 3),
                    travel.bearing = c(0, 20), 
                    travel.step = c(3, 3), 
                    foraging.bearing = c(0, 0.5), 
                    foraging.step = c(1, 3),
                    minx = 0, maxx = 90, 
                    miny = 0, maxy = 90,
                    step.duration = 1,
                    activity.threshold = 0.7,
                    max.duration = 100)))
  
  expect_error(simulate_trajectory_FR(initial.position = colony.location, 
                    resource.layer = colony.location, 
                    starting.hour = ymd_hms(sunrise), 
                    starting.bearing = c(90,10), 
                    starting.step = c(4.5, 3),
                    travel.bearing = c(0, 20), 
                    travel.step = c(3, 3), 
                    foraging.bearing = c(0, 0.5), 
                    foraging.step = c(1, 3),
                    minx = 0, maxx = 90, 
                    miny = 0, maxy = 90,
                    step.duration = 5,
                    activity.threshold = 0.70,
                    max.duration = 100))
  
  expect_error(simulate_trajectory_FR(initial.position = data.frame(Lon = c(50,60), Lat = c(50,60)), 
                        resource.layer = cdt$rasters, 
                        starting.hour = ymd_hms(sunrise), 
                        starting.bearing = c(90,10), 
                        starting.step = c(4.5, 3),
                        travel.bearing = c(0, 20), 
                        travel.step = c(3, 3), 
                        foraging.bearing = c(0, 0.5), 
                        foraging.step = c(1, 3),
                        minx = 0, maxx = 40, 
                        miny = 0, maxy = 40,
                        step.duration = 5,
                        activity.threshold = 0.70,
                        max.duration = 100))
  

})
