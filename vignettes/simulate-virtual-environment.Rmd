---
title: "Simulate virtual environment"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{simulate-virtual-environment}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(simtools)
```

<!-- WARNING - This vignette is generated by {fusen} from dev/flat_simulate_env.Rmd: do not edit by hand -->

<!-- Run this 'development' chunk -->
<!-- Store every call to library() that you need to explore your functions -->


# Create the grid

Create the grid structuring the virtual environment. By default, `create_grid()` creates a grid spanning 0 to 90Â° in both longitude and latitude, with steps of 0.5. 


  

```{r example-create_grid}
grid <- create_grid()
```

  

  


# Generating environmental layers

The `generate_env_layer()` function creates several environmental layers using Gaussian simulation from the grid locations. The number of layers generated is set by n. The generated layers can be normalised, and be returned either only as data frame or both in data frame and raster formats (SpatRast). 



  

```{r example-generate_env_layer}
grid <- create_grid()

str(generate_env_layer(norm = FALSE, return_rasters = FALSE, grid = grid))

library(terra)
plot(generate_env_layer(norm = TRUE, return_rasters = TRUE, grid = grid)$rasters)
```

  

  


# Build the suitability layer

The `generate_resource_layer()` function permits building a suitability layer from a set of environmental layers and beta parameters to be leveraged with. It mimics a basic resource selection function, where a given environmental layer is simply scaled by the beta parameter (env*beta) and several leveraged env layers are additively combined. For more elaborate procedures, see the [virtualspecies package](https://borisleroy.com/files/virtualspecies-tutorial.html).

    

  

```{r example-generate_resource_layer}
library(terra)
# simple example
grid <- create_grid()
cdt <- generate_env_layer(grid = grid)
rsce <- generate_resource_layer(env_layers = cdt$rasters,
                            beta = c(2, -1.5))
str(rsce)
plot(rsce$rasters)

# also works when coordinates are not names x,y
cdt2 <- generate_env_layer(grid = grid, n = 3)$dataframe |> dplyr::rename(lon = x, lat = y)
str(generate_resource_layer(env_layers = cdt2, coordinate_fields = c("lon", "lat"),
                            beta = c(2, -1.5, 3)) )
```

  

  




