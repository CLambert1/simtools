---
title: "Simulate virtual species"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{simulate-virtual-species}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(simtools)
```

<!-- WARNING - This vignette is generated by {fusen} from dev/flat_simulate_sp.Rmd: do not edit by hand -->

# Create a custom projection

The upcoming analyses necessitates working in a projected environment. Because we are in a virtual environment, we must define a custom projection. This is what does `custom_proj()`.
    

  

```{r example-custom_proj}
custom_proj()
```

  

  

    

  



# Simulate spatial point process

Generates a spatial point process from a reference map, using Inhomogeneous Poisson Point Process with spatstat's IPP. The intensity of the process is proportional to this reference map, and the final number of individuals in the population is provided by N. Several runs can be simulated at the same time. 

To do : add an id to each generated obs (only done when n_sim = 1)



```{r examples-simul_spat}
grid <- create_grid()
cdt <- generate_env_layer(grid = grid)
rsce <- generate_resource_layer(env_layers = cdt$rasters,
                            beta = c(2, -1.5))

# issue a warning: we are in a virtual env and ref_map has no crs
out <- simul_spat(ref_map = rsce$rasters, n_sim = 2, 
                  return_wgs_coordinates = FALSE, N = 1000, mean_group_size = 10)

ggplot2::ggplot(out) +
  ggplot2::geom_tile(data = rsce$dataframe, ggplot2::aes(x = x, y = y, fill = suitability)) + 
  ggplot2::geom_sf() + ggplot2::facet_wrap("name") +
  viridis::scale_fill_viridis(option = "H")

ggplot2::ggplot(out) +
   ggplot2::geom_sf(ggplot2::aes(size = size)) + ggplot2::facet_wrap("name") 

```

